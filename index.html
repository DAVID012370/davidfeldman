viewTabs.forEach((btn) => {
  btn.addEventListener("click", () => {
    const targetView = btn.dataset.view || "visualizer";
    if (targetView === currentView) return; // nothing to do

    // 1) Leaving VISUALIZER → going to LOGO
    if (currentView === "visualizer" && targetView === "logo") {
      if (audioElement && isPlaying) {
        const keepPlaying = window.confirm(
          "You are switching to Logo view.\nDo you want the music to KEEP playing?"
        );
        if (!keepPlaying) {
          audioElement.pause();
          isPlaying = false;
          playPauseBtn.textContent = "Play";
          statusText.textContent = "Paused (stopped when switching to Logo view).";
        }
      }
    }

    // 2) Leaving LOGO → going to VISUALIZER
    if (currentView === "logo" && targetView === "visualizer") {
      if (logoImage) {
        const keepLogo = window.confirm(
          "You are switching to Visualizer view.\nDo you want to KEEP the current logo?"
        );
        if (!keepLogo) {
          logoImage = null;
          if (logoUrl) {
            URL.revokeObjectURL(logoUrl);
            logoUrl = null;
          }
          statusText.textContent = "Logo cleared when switching to Visualizer view.";
        }
      }
    }

    // Now actually switch view
    currentView = targetView;

    viewTabs.forEach((b) => {
      b.classList.toggle("active", b.dataset.view === currentView);
    });

    if (currentView === "logo") {
      logoControls.classList.remove("hidden");
    } else {
      logoControls.classList.add("hidden");
    }

    updateWatermark();
  });
});
